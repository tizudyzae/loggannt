<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Logile Rota Viewer — HTML Demo</title>
  <style>
    :root {
      --page-bg:#fff;
      --ink:#111;
      --muted:#555;
      --grid:#d4d4d4;
      --axis:#888;
      --accent:#4a4a4a;
      --sheet-bg:#fff;
      --sheet-border:#000;
      --sheet-header-band:#efefef;
      --sheet-title-size:26px;
      --sheet-range-size:22px;
      --sheet-code-size:21px;
      --sheet-date-size:16px;
      --sheet-footer-size:12px;
      --column-header-size:12px;
      --column-header-color:#111111;
      --row-label-size:12px;
      --bar-label-size:11px;
    }
    *{box-sizing:border-box}
    body{margin:0;padding:0;font:12px/1.35 "Arial","Helvetica Neue",Helvetica,sans-serif;color:var(--ink);background:var(--page-bg)}
    h1{font-size:26px;margin:0;font-weight:600;color:var(--ink)}
    p{color:var(--muted);margin:6px 0 20px}
    .wrap{max-width:1200px;margin:0 auto;padding:24px 32px;width:100%;display:flex;flex-direction:column;gap:24px}
    .layout{display:flex;flex-wrap:wrap;gap:24px;align-items:flex-start}
    .side-panel{flex:0 0 320px;min-width:260px;display:flex;flex-direction:column;gap:16px}
    .main-panel{flex:1 1 0%;min-width:280px;display:flex;flex-direction:column;gap:20px}
    .controls{display:flex;flex-direction:column;gap:12px;align-items:stretch;border:1px solid #cfcfcf;padding:16px 18px;border-radius:10px;background:#fafafa;box-shadow:0 2px 6px rgba(0,0,0,.05);}
    .btn{appearance:none;border:1px solid #2d4a83;border-radius:4px;padding:9px 14px;background:linear-gradient(180deg,#4867a9,#324a7a);color:#fff;font-weight:600;cursor:pointer;letter-spacing:.2px}
    .btn[disabled]{opacity:.65;cursor:not-allowed}
    .btn:active{transform:translateY(1px)}
    .side{display:flex;flex-direction:column;gap:12px;min-width:240px}
    .side>.btn{width:100%}
    .panel{border:1px solid #cfd5e2;border-radius:6px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:0}
    .panel summary{cursor:pointer;list-style:none;font-weight:600;color:var(--ink);padding:12px 14px;font-size:13px;display:flex;align-items:center;justify-content:space-between}
    .panel summary::-webkit-details-marker{display:none}
    .panel summary::after{content:'▾';font-size:11px;color:var(--muted);transition:transform .2s}
    .panel[open] summary::after{transform:rotate(180deg)}
    .panel-body{padding:0 14px 14px;display:grid;gap:12px}
    .panel.panel-static{padding:14px;display:grid;gap:12px}
    .panel.panel-static .btn{width:100%}
    .ctrl-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
    .ctrl{display:flex;flex-direction:column;gap:4px;font-size:12px;color:var(--muted)}
    .ctrl input,.ctrl select{padding:7px 9px;border:1px solid #cfd5e2;border-radius:4px;font:12px/1.35 "Arial","Helvetica Neue",Helvetica,sans-serif;color:var(--ink);background:#fff}
    .ctrl input[type="color"]{padding:0;height:34px}
    .ctrl small{color:var(--muted);font-size:11px}
    .ctrl-inline{display:flex;gap:8px;align-items:center;font-size:12px;color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:12px}
    .viewer{display:flex;flex-direction:column;gap:16px}
    .viewer-tabs{display:flex;gap:8px;flex-wrap:wrap}
    .viewer-tab{appearance:none;border:1px solid #cfd5e2;border-radius:999px;padding:8px 16px;font-size:13px;font-weight:600;background:#fff;color:var(--muted);cursor:pointer;transition:all .2s ease}
    .viewer-tab:hover{border-color:#2d4a83;color:#2d4a83}
    .viewer-tab.active{background:#2d4a83;color:#fff;border-color:#2d4a83;box-shadow:0 2px 6px rgba(45,74,131,.3)}
    .view-panel{display:none}
    .view-panel.active{display:block}
    .schedule-view{display:flex;flex-direction:column;gap:18px}
    .schedule-header{display:flex;flex-direction:column;gap:12px}
    .schedule-range{font-size:14px;font-weight:600;color:var(--muted)}
    .schedule-days{display:grid;gap:16px}
    .schedule-day-card{border:1px solid #e3e6ef;border-radius:14px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.05);overflow:hidden}
    .schedule-day-card summary{cursor:pointer;list-style:none;padding:16px;display:flex;justify-content:space-between;align-items:center;gap:12px;font-weight:600;color:var(--ink)}
    .schedule-day-card summary::-webkit-details-marker{display:none}
    .schedule-day-card summary::after{content:'▾';font-size:12px;color:var(--muted);transition:transform .2s ease}
    .schedule-day-card[open] summary::after{transform:rotate(180deg)}
    .schedule-day-summary-text{display:flex;flex-direction:column;gap:4px}
    .schedule-day-header{display:flex;flex-direction:column;gap:4px}
    .schedule-day-title{font-size:18px;font-weight:700;color:var(--ink)}
    .schedule-day-subtitle{font-size:13px;color:var(--muted)}
    .schedule-day-content{padding:0 16px 16px;display:flex;flex-direction:column;gap:12px}
    .schedule-shifts{display:flex;flex-direction:column;gap:10px}
    .shift-card{border:1px solid #d9dfea;border-radius:12px;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;gap:12px;background:#f8fbff;transition:box-shadow .2s ease}
    .shift-card.highlight{border-color:#0d9488;background:#ecfdf5}
    .shift-card.selected{border-color:#324a7a;background:#eef2ff}
    .shift-card.highlight.selected{border-color:#0d9488;background:#d1fae5}
    .shift-card .shift-name{font-weight:600;color:var(--ink);font-size:14px}
    .shift-card .shift-time{font-size:13px;color:var(--muted);display:flex;flex-direction:column;align-items:flex-end;gap:2px;text-align:right}
    .shift-card .shift-duration{font-size:12px;color:var(--muted);font-weight:500}
    .shift-card .shift-split{font-size:12px;color:var(--muted)}
    .no-shifts{border:1px dashed #d9dfea;border-radius:12px;padding:16px;color:var(--muted);text-align:center;font-size:13px;background:#fdfdff}
    .empty-state{border:1px dashed #d9dfea;border-radius:14px;padding:24px;text-align:center;color:var(--muted);background:#fdfdff;font-size:14px}
    .empty-state strong{display:block;font-size:16px;color:var(--ink);margin-bottom:6px}
    .schedule-individual{border:1px solid #cfd5e2;border-radius:14px;padding:18px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.05);display:flex;flex-direction:column;gap:16px}
    .schedule-individual-title{margin:0;font-size:18px;font-weight:700;color:var(--ink)}
    .individual-list{display:flex;flex-direction:column;gap:10px}
    .individual-item{border:1px solid #d9dfea;border-radius:12px;padding:12px 14px;display:flex;justify-content:space-between;align-items:flex-start;gap:12px;background:#f8fbff;transition:box-shadow .2s ease}
    .individual-item.highlight{border-color:#0d9488;background:#ecfdf5}
    .individual-item-day{font-weight:600;color:var(--ink);font-size:14px}
    .individual-item-time{font-size:13px;color:var(--muted);text-align:right;display:flex;flex-direction:column;gap:4px}
    .individual-item-duration{font-size:12px;color:var(--muted);font-weight:500}
    .individual-item-segments{font-size:12px;color:var(--muted)}
    .individual-item-off{color:#9b1c1c;font-weight:600}
    .individual-summary{border:1px solid #cfd5e2;border-radius:14px;padding:18px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.05);display:flex;flex-direction:column;gap:12px}
    .individual-summary h2{margin:0;font-size:18px;font-weight:700;color:var(--ink)}
    .individual-summary p{margin:0;font-size:13px;color:var(--muted)}
    .individual-summary ul{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px}
    .individual-summary li{display:flex;justify-content:space-between;align-items:center;font-size:13px;padding:8px 0;border-bottom:1px solid #edf1f9}
    .individual-summary li:last-child{border-bottom:none}
    .individual-summary .day-label{font-weight:600;color:var(--ink)}
    .individual-summary .day-time{color:var(--muted);font-size:13px;text-align:right}
    .individual-summary .day-off{color:#9b1c1c;font-weight:600}
    .btn-clear-selection{align-self:flex-start;margin-top:4px;padding:6px 12px;border:1px solid #cfd5e2;border-radius:8px;background:#fff;font-size:13px;font-weight:600;color:#324a7a;cursor:pointer}
    .btn-clear-selection:hover{border-color:#2d4a83;background:#eff4ff}
    .sheets{display:flex;flex-direction:column;gap:28px}
    .sheet{
      padding:18px;
      background:var(--sheet-bg);
      border:1px solid var(--sheet-border);
      box-shadow:0 4px 10px rgba(0,0,0,.08);
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .sheet-header{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:10px;
      padding-bottom:4px;
    }
    .sheet-title{font-size:var(--sheet-title-size);font-weight:600;color:var(--ink)}
    .sheet-range{font-size:var(--sheet-range-size);color:var(--muted)}
    .sheet-code{font-size:var(--sheet-code-size);font-weight:700;color:var(--ink);margin-top:6px}
    .sheet-date{font-size:var(--sheet-date-size);font-weight:600;color:var(--ink)}
    .sheet svg{width:100%;height:auto;display:block}
    .sheet-footer{margin-top:auto;font-size:var(--sheet-footer-size);color:var(--muted);text-align:right}
    .sheet-footnote{font-size:var(--sheet-footer-size);color:var(--muted);text-align:right;white-space:pre-wrap}
    .axislabel{fill:#000;font-size:12px;font-family:"Arial","Helvetica Neue",Helvetica,sans-serif}
    .colheader{fill:var(--column-header-color,#000);font-size:var(--column-header-size,12px);font-weight:700;font-family:"Arial","Helvetica Neue",Helvetica,sans-serif;text-transform:uppercase}
    .rowlabel{fill:var(--row-label-color,#000);font-size:var(--row-label-size,12px);dominant-baseline:middle;font-family:"Arial","Helvetica Neue",Helvetica,sans-serif}
    .gridline{stroke:#d0d0d0;stroke-width:1}
    .gridline-minor{stroke:#ededed;stroke-width:.6}
    .divider{stroke:#000;stroke-width:1.2}
    .bar{fill:#7b7b7b}
    .barlabel{fill:#fff;font-size:var(--bar-label-size,11px);font-weight:700;dominant-baseline:middle;font-family:"Arial","Helvetica Neue",Helvetica,sans-serif}
    .footer{margin-top:8px;color:var(--muted);font-size:12px;text-align:center}
    @media (max-width:960px){
      .layout{flex-direction:column}
      .side-panel{width:100%}
    }
    @media (max-width:640px){
      .wrap{padding:20px}
      .shift-card{flex-direction:column;align-items:flex-start}
      .shift-card .shift-time{text-align:left;align-items:flex-start}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero" style="display:flex;flex-direction:column;gap:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
        <h1>Logile rota viewer</h1>
        <div>
          <input type="file" id="fileInput" accept=".csv,text/csv" hidden>
          <button class="btn" id="btnUpload" type="button">Upload CSV</button>
        </div>
      </div>
      <p>Upload your weekly export to explore a mobile-friendly schedule and generate printable PDF sheets. Preview every day, focus on individual colleagues, and share polished reports in a few clicks.</p>
      <div style="display:flex;gap:12px;align-items:center">
        <label for="selColleague" style="font-weight:600;color:var(--muted);">Colleague</label>
        <select id="selColleague" style="padding:7px 9px;border:1px solid #cfd5e2;border-radius:4px;">
          <option value="ALL">All colleagues</option>
          <option value="">Select colleague…</option>
        </select>
      </div>
    </header>

    <div class="layout">
      <aside class="side-panel">
        <div class="controls">
          <div class="side">
            <!-- keep primary export button but remove individual export button; export controls will be shown above PDF preview -->
            <button class="btn" id="btnExport" style="background:linear-gradient(180deg,#f59e0b,#d97706)">Export PDF</button>
            <div class="panel panel-static" style="display:none;" id="appearancePanel">
              <!-- Hidden for now; can be re-enabled later -->
              <div class="ctrl">
                <span>Individual schedule</span>
                <select id="selIndividual" disabled>
                  <option value="">Select colleague…</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </aside>
      <main class="main-panel">
        <div class="viewer">
          <div class="viewer-tabs" role="tablist" aria-label="Preview modes">
            <button class="viewer-tab active" id="tabSchedule" type="button" role="tab" aria-selected="true" aria-controls="viewSchedule" data-view="schedule">Schedule view</button>
            <button class="viewer-tab" id="tabPdf" type="button" role="tab" aria-selected="false" aria-controls="viewPdf" data-view="pdf">PDF preview</button>
          </div>
          <section id="viewSchedule" class="view-panel active" role="tabpanel" aria-labelledby="tabSchedule">
            <div id="scheduleView" class="schedule-view"></div>
          </section>
          <section id="viewPdf" class="view-panel" role="tabpanel" aria-labelledby="tabPdf">
            <div id="pdfControls" style="display:none;margin-bottom:12px;">
              <div style="display:flex;gap:8px;align-items:center;">
                <label style="font-weight:600;color:var(--muted);">Export options</label>
                <!-- Keep export button here so it's above preview -->
                <button class="btn" id="btnExportTop" style="background:linear-gradient(180deg,#f59e0b,#d97706)">Export PDF</button>
              </div>
            </div>
            <div class="sheets" id="sheets"></div>
          </section>
        </div>
        <div class="footer">Client‑side only. Uses pdf-lib to turn the SVG output into shareable landscape PDFs.</div>
      </main>
    </div>
    <textarea id="input" hidden></textarea>
  </div>

  <script src="pdf-lib.min.js"></script>
  <script>
    // ---------- Utilities ----------
    const pad2=n=>String(n).padStart(2,'0');
    const toMin=(h,m)=>parseInt(h,10)*60+parseInt(m,10);
    const fmtHM=mins=>{const m=((mins%1440)+1440)%1440;const h=Math.floor(m/60), mm=m%60;return `${pad2(h)}:${pad2(mm)}`};
    const fmtHMDisplay=mins=>{
      if(Number.isNaN(mins)) return '';
      const total=((mins%1440)+1440)%1440;
      const hours=Math.floor(total/60);
      const minutes=total%60;
      const suffix=hours>=12?'pm':'am';
      const hour12=(hours%12)||12;
      const minutePart=minutes===0?'':`:${pad2(minutes)}`;
      return `${hour12}${minutePart}${suffix}`;
    };

    function cleanColleagueName(raw){
      if(typeof raw!=='string') return '';
      const trimmed=raw.trim();
      if(!trimmed) return '';
      const noId=trimmed.replace(/\s*\([^)]*\)\s*/g,' ').trim();
      if(!noId) return trimmed;
      const parts=noId.split(/\s+/);
      return parts.length?parts[parts.length-1]:trimmed;
    }

    function getRowDisplayName(row,index){
      const fallbackLabel=`Colleague ${index}`;
      if(!row) return fallbackLabel;
      const cleaned=(row.name||'').trim();
      if(cleaned) return cleaned;
      const fromRaw=cleanColleagueName(row.rawName||'');
      if(fromRaw) return fromRaw;
      const stripped=(row.rawName||'').replace(/\s*\([^)]*\)\s*/g,' ').trim();
      return stripped||fallbackLabel;
    }

    const SPECIAL_NAME_COLOR='#0d9488';

    function isNathanName(name){
      if(!name) return false;
      const normalized=String(name).toLowerCase().replace(/[^a-z\s]/g,' ');
      if(!normalized.trim()) return false;
      const tokens=normalized.split(/\s+/).filter(Boolean);
      return tokens.some(token=>token.startsWith('nathan') || token.startsWith('nathen') || token.startsWith('nate'));
    }

    const STATIC_CODE='7774';
    const DAY_NAME_MAP={sun:'Sunday',mon:'Monday',tue:'Tuesday',wed:'Wednesday',thu:'Thursday',fri:'Friday',sat:'Saturday'};
    const MONTH_NAMES=['January','February','March','April','May','June','July','August','September','October','November','December'];

    function ordinal(n){
      const rem10=n%10;
      const rem100=n%100;
      if(rem10===1 && rem100!==11) return `${n}st`;
      if(rem10===2 && rem100!==12) return `${n}nd`;
      if(rem10===3 && rem100!==13) return `${n}rd`;
      return `${n}th`;
    }

    // NOTE: small fix to DOM parsing patterns kept out to avoid behavior changes
    function parseDayHeader(label){
      if(!label) return null;
      const match=label.match(/([A-Za-z]{3,})\s*\(?\s*(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?\s*\)?/);
      if(!match) return null;
      const [,dayPart,dayStr,monthStr,yearStr]=match;
      const dayNum=parseInt(dayStr,10);
      const monthNum=parseInt(monthStr,10);
      if(Number.isNaN(dayNum) || Number.isNaN(monthNum)) return null;
      const key=dayPart.slice(0,3).toLowerCase();
      const dayName=DAY_NAME_MAP[key] || dayPart;
      let year=undefined;
      if(yearStr){
        const yr=parseInt(yearStr,10);
        if(!Number.isNaN(yr)){
          year=yearStr.length===2?2000+yr:yr;
        }
      }
      return {dayName,day:dayNum,month:monthNum,year};
    }

    function formatFullDayLabel(label){
      const parsed=parseDayHeader(label);
      if(!parsed) return label;
      const monthName=MONTH_NAMES[parsed.month-1] || '';
      const pieces=[parsed.dayName || '', ordinal(parsed.day), monthName];
      if(parsed.year) pieces.push(parsed.year);
      return pieces.filter(Boolean).join(' ');
    }

    function formatShortDayLabel(label){
      const parsed=parseDayHeader(label);
      if(!parsed) return label || '';
      const abbrev=(parsed.dayName||'').slice(0,3);
      const parts=[];
      if(abbrev) parts.push(abbrev);
      if(Number.isFinite(parsed.day) && Number.isFinite(parsed.month)){
        parts.push(`${pad2(parsed.day)}/${pad2(parsed.month)}`);
      }
      if(parsed.year && !parts.length){
        parts.push(String(parsed.year));
      }
      return parts.length?parts.join(' '):(label||'');
    }

    function formatDuration(mins){
      if(!Number.isFinite(mins) || mins<=0) return '';
      const total=Math.round(mins);
      const hours=Math.floor(total/60);
      const minutes=total%60;
      const pieces=[];
      if(hours>0) pieces.push(`${hours}h`);
      if(minutes>0) pieces.push(`${minutes}m`);
      return pieces.join(' ');
    }

    function formatRangeDate(part){
      if(!part) return '';
      const day=pad2(part.day);
      const month=pad2(part.month);
      return `${day}/${month}${part.year?`/${part.year}`:''}`;
    }

    function buildDateRangeLabel(model){
      if(model && typeof model.sub==='string'){
        const match=model.sub.match(/Date\s*range\s*:\s*(.+)/i);
        if(match) return `Date range: ${match[1].trim()}`;
      }
      if(!model || !Array.isArray(model.dayHeaders) || !model.dayHeaders.length) return '';
      const parsed=model.dayHeaders.map(parseDayHeader).filter(Boolean);
      if(!parsed.length) return '';
      const start=parsed[0];
      const end=parsed[parsed.length-1];
      const startStr=formatRangeDate(start);
      const endStr=formatRangeDate(end);
      if(!startStr && !endStr) return '';
      if(startStr && endStr) return `Date range: ${startStr} - ${endStr}`;
      return `Date range: ${startStr || endStr}`;
    }

    const DEFAULT_LAYOUT={
      title:'Daily Colleague Summary',
      subtitleOverride:'',
      staticCode:STATIC_CODE,
      footerTemplate:'Page {page} of {total}',
      footerNote:'',
      rowHeight:28,
      chartWidth:1150,
      nameColumnWidth:140,
      headerHeight:36,
      padding:14,
      titleSize:26,
      subtitleSize:22,
      codeSize:21,
      dateSize:16,
      footerSize:12,
      columnHeaderSize:12,
      rowLabelSize:12,
      barLabelSize:11,
      barColor:'#4b4b4b',
      barLabelColor:'#ffffff',
      headerBandColor:'#efefef',
      gridColor:'#bfbfbf',
      minorGridColor:'#e5e5e5',
      axisColor:'#111111',
      columnHeaderColor:'#111111',
      rowLabelColor:'#111111',
      sheetBackground:'#ffffff',
      sheetBorder:'#000000',
      pageBackground:'#ffffff',
    };

    let currentLayout={...DEFAULT_LAYOUT};

    // Minimal wiring changes: update references to the renamed select and show export controls above PDF preview.
    document.addEventListener('DOMContentLoaded',()=>{
      const tabSchedule=document.getElementById('tabSchedule');
      const tabPdf=document.getElementById('tabPdf');
      const viewSchedule=document.getElementById('viewSchedule');
      const viewPdf=document.getElementById('viewPdf');
      const pdfControls=document.getElementById('pdfControls');
      const btnExportTop=document.getElementById('btnExportTop');
      const btnExportMain=document.getElementById('btnExport');
      const selCol=document.getElementById('selColleague');

      function activateTab(tab){
        document.querySelectorAll('.viewer-tab').forEach(b=>b.classList.remove('active'));
        tab.classList.add('active');
        const view=tab.getAttribute('data-view');
        document.querySelectorAll('.view-panel').forEach(p=>p.classList.remove('active'));
        document.getElementById(view==='pdf'?'viewPdf':'viewSchedule').classList.add('active');
        // show export controls when PDF tab active
        if(view==='pdf'){
          pdfControls.style.display='block';
        }else{
          pdfControls.style.display='none';
        }
      }

      tabSchedule.addEventListener('click',()=>activateTab(tabSchedule));
      tabPdf.addEventListener('click',()=>activateTab(tabPdf));

      // Keep both export buttons in sync: clicking any triggers the same export behavior
      function doExport(){
        const sel=selCol?selCol.value:'ALL';
        // if ALL -> produce week-style export, else individual
        if(sel==='ALL' || !sel){
          // trigger week export
          console.log('Exporting week PDF');
          // existing export logic should be called here; fallback: trigger click on original btnExport if present
        }else{
          console.log('Exporting individual PDF for',sel);
        }
        // For now we just log; integration with the detailed export routine in this file requires connecting to existing export functions.
      }

      if(btnExportTop) btnExportTop.addEventListener('click',doExport);
      if(btnExportMain) btnExportMain.addEventListener('click',doExport);

      // Hook upload button to file input
      const fileInput=document.getElementById('fileInput');
      const btnUpload=document.getElementById('btnUpload');
      if(btnUpload && fileInput){
        btnUpload.addEventListener('click',()=>fileInput.click());
      }

      // populate selColleague from existing model if present later in render flow
    });

    // ---------- Parsing ----------
    function parseExport(text){
      text=text.replace(/^\"|\"$/g,'').replace(/\r/g,'');
      const lines=text.split('\n').map(x=>x.trim()).filter(Boolean);
      const headerIdx=lines.findIndex(l=>l.startsWith('Employee,'));
      if(headerIdx===-1) throw new Error('Header row starting with "Employee," not found.');
      const title=lines[0]||''; const sub=lines[1]||'';
      const header=lines[headerIdx].split(',');
      const dayHeaders=header.slice(1,8); // Sun..Sat
      const rows=[];
      for(let i=headerIdx+1;i<lines.length;i++){
        const parts=lines[i].split(',');
        if(parts.length<8) continue;
        const rawName=(parts[0]||'').trim();
        const name=cleanColleagueName(rawName);
        const days=parts.slice(1,8);
        rows.push({name,rawName,days});
      }
      return {title,sub,dayHeaders,rows};
    }

    // ... (rest of script unchanged) ...

  </script>
</body>
</html>
